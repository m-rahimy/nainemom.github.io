---
layout: default
---
{% include feed.html %}
<article class="post">
	<div class="header">
		<h2 class="title">
			<a href="{{ site.baseurl }}{{ page.url }}">{{ page.title }}</a>
		</h2>
		<h6 class="by">
			<i class="icon icon-pencil"></i>
			{{ page.by }}
		</h6>
		<h6 class="date">
			<i class="icon icon-calendar-empty"></i>
			{% assign d = page.date | date: "%-d" %}{% case d %}{% when '1' %}۱{% when '2' %}۲{% when '3' %}۳{% when '4' %}۴{% when '5' %}۵{% when '6' %}۶{% when '7' %}۷{% when '8' %}۸{% when '9' %}۹{% when '10' %}۱۰{% when '11' %}۱۱{% when '12' %}۱۲{% when '13' %}۱۳{% when '14' %}۱۴{% when '15' %}۱۵{% when '16' %}۱۶{% when '17' %}۱۷{% when '18' %}۱۸{% when '19' %}۱۹{% when '20' %}۲۰{% when '21' %}۲۱{% when '22' %}۲۲{% when '23' %}۲۳{% when '24' %}۲۴{% when '25' %}۲۵{% when '26' %}۲۶{% when '27' %}۲۷{% when '28' %}۲۸{% when '29' %}۲۹{% when '30' %}۳۰{% when '31' %}۳۱{% endcase %}
			{% assign m = page.date | date: "%-m" %}{% case m %}{% when '1' %}فروردین{% when '2' %}اردیبهشت{% when '3' %}خرداد{% when '4' %}تیر{% when '5' %}مرداد{% when '6' %}شهریور{% when '7' %}مهر{% when '8' %}آبان{% when '9' %}آذر{% when '10' %}دی{% when '11' %}بهمن{% when '12' %}اسفند{% endcase %}
			{% assign y = page.date | date: "%-y" %}{% case y %}{% when '94' %}۹۴{% when '95' %}۹۵{% when '96' %}۹۶{% when '97' %}۹۷{% when '98' %}۹۸{% when '99' %}۹۹{% when '00' %}۰۰{% endcase %}
		</h6>
		<h6 class="tags">
			<i class="icon icon-tags"></i>
			{% for tag in page.tags %}
				<a href="https://www.google.com/webhp?#q={{tag}}+site:{{ site.url }}" rel="tag">{{tag}}</a> 
			{% endfor %}
		</h6>
		<h6 class="tags">
			<i class="icon icon-eye"></i>
			<span id="reads-count"><div class="loading"></div></span>
		</h6>
		<div class="clear-both"></div>
	</div>
	<div class="body">
		{{ content }}
	</div>
	<br/>
	<div class="comments">
		<form class="new-comment" id="new-comment" method="post" action="{{site.commenturl}}index.php">
			<input type="hidden" name="operation" value="add">
			<input type="hidden" name="data[redirect_to]" value="{{site.url}}{{page.url}}#comment_success">
			<input type="hidden" name="data[post]" id="post-id" value="{{page.id}}">
			<input type="text" id="comment-name" name="data[name]" placeholder="نام خود را وارد کنید." required>
			<span id="add-comment-link" class="add-comment-link"> اضافه کردن لینک </span> 
			<input type="hidden" id="comment-link" name="data[link]">
			<textarea name="data[body]" placeholder="نظر خود را راجع به این داستان بنویسید." required></textarea>
			<button type="submit"> انتشار </button>
		</form>
		<div class="list">
			<div id="comment-list">
				<div class="loading"></div>
			</div>
		</div>
		<div class="clear-both"></div>
	</div>
</article>

<script>
	var commentForm = document.getElementById('new-comment');
	var commentName = document.getElementById('comment-name');
	var commentLink = document.getElementById('comment-link');
	var addCommentLink = document.getElementById('add-comment-link');
	
	loadJSON('{{site.commenturl}}index.php?operation=fetch&data[post]={{page.id}}', function(data){
		commentsToLayout('comment-list', data.response.comments);
		document.getElementById('reads-count').innerHTML = traverse(data.response.reads)+ ' بار';
		
		if( document.location.toString().indexOf('#comment_success') > 0 ){
			window.history.pushState('', 'Title', '#');
			(function() {
			   window.scrollTo(0, document.body.scrollHeight);
			})();
			alert('ممنون از نظرتون. :-)');
		}
	});
	addCommentLink.onclick = function(e){
		var oldLink = commentLink.value;
		var newLink = prompt('اگر صفحه‌ای دارید که دوست دارید کامنت شما به آن لینک شود، اینجا وارد کنید.', oldLink);
		if( typeof newLink == 'string' && newLink != '' && isUrl(newLink) )
			commentLink.value = newLink;
		addLinkInit();
	}
	function addLinkInit(){
		if( commentLink.value == '' )
			addCommentLink.innerHTML = 'اضافه کردن لینک';
		else	
			addCommentLink.innerHTML = 'تغییر لینک';
	}
	commentForm.onsubmit = function(e){
		if( typeof window.localStorage != 'undefined' ){
			window.localStorage.name = commentName.value;
			window.localStorage.link = commentLink.value;
		}
	}
	if( typeof window.localStorage != 'undefined' ){
		commentName.value = window.localStorage.name;
		commentLink.value = window.localStorage.link;
		addLinkInit();
	}
</script>
